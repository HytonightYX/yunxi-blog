<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>[ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å— - Hytonightäº‘æ¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:600&display=swap&subset=chinese-simplified" rel="stylesheet">


    <meta name="description" content="åŸæ–‡åœ°å€ï¼šYou donâ€™t need passport.js - Guide to node.js authentication åŸæ–‡ä½œè€…ï¼šSam Quinn è¯‘æ–‡å‡ºè‡ªï¼šæ˜é‡‘ç¿»è¯‘è®¡åˆ’ æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼šhttps://github.com/xitu/gold-miner/blob/master/TODO1/nodejs-jwt-authentication-oauth.md è¯‘è€…ï¼šHytonig">
<meta property="og:type" content="article">
<meta property="og:title" content="[ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å—">
<meta property="og:url" content="http://yunxi.site/blog/2019/12/27/ç¿»è¯‘-ä½ ä¸éœ€è¦-passport-js-â€”-node-jsè®¤è¯æŒ‡å—/index.html">
<meta property="og:site_name" content="Hytonightäº‘æ¯">
<meta property="og:description" content="åŸæ–‡åœ°å€ï¼šYou donâ€™t need passport.js - Guide to node.js authentication åŸæ–‡ä½œè€…ï¼šSam Quinn è¯‘æ–‡å‡ºè‡ªï¼šæ˜é‡‘ç¿»è¯‘è®¡åˆ’ æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼šhttps://github.com/xitu/gold-miner/blob/master/TODO1/nodejs-jwt-authentication-oauth.md è¯‘è€…ï¼šHytonig">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yunxi.site/blog/images/og_image.png">
<meta property="og:updated_time" content="2020-02-09T07:35:06.063Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å—">
<meta name="twitter:description" content="åŸæ–‡åœ°å€ï¼šYou donâ€™t need passport.js - Guide to node.js authentication åŸæ–‡ä½œè€…ï¼šSam Quinn è¯‘æ–‡å‡ºè‡ªï¼šæ˜é‡‘ç¿»è¯‘è®¡åˆ’ æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼šhttps://github.com/xitu/gold-miner/blob/master/TODO1/nodejs-jwt-authentication-oauth.md è¯‘è€…ï¼šHytonig">
<meta name="twitter:image" content="http://yunxi.site/blog/images/og_image.png">







<link rel="icon" href="/blog/assets/img/logo.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/tomorrow.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/blog/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/blog/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/blog/css/style.css">

</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/blog/">
            
                <img src="/blog/assets/img/logo.png" alt="[ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å—" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/blog/">Home</a>
                
                <a class="navbar-item" href="/blog/archives/">Archives</a>
                
                <a class="navbar-item" href="/blog/tags/">Tags</a>
                
                <a class="navbar-item" href="/blog/about/">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="HytonightYX GitHub" href="https://github.com/HytonightYX">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="CatÃ¡logo" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                [ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å—
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-12-27T07:23:01.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-12-27</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-02-09T07:35:06.063Z"><i class="far fa-calendar-check">&nbsp;</i>2020-02-09</time>
                
                
                
                <span class="level-item has-text-grey">
                    <i class="far fa-clock"></i>&nbsp;
                    
                    
                    21 minutes read (About 3086 words)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <div class="content">
            <blockquote>
<ul>
<li>åŸæ–‡åœ°å€ï¼š<a href="https://softwareontheroad.com/nodejs-jwt-authentication-oauth/" target="_blank" rel="noopener">You donâ€™t need passport.js - Guide to node.js authentication</a></li>
<li>åŸæ–‡ä½œè€…ï¼š<a href="https://softwareontheroad.com/author/santypk-4/" target="_blank" rel="noopener">Sam Quinn</a></li>
<li>è¯‘æ–‡å‡ºè‡ªï¼š<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a></li>
<li>æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š<a href="https://github.com/xitu/gold-miner/blob/master/TODO1/nodejs-jwt-authentication-oauth.md" target="_blank" rel="noopener">https://github.com/xitu/gold-miner/blob/master/TODO1/nodejs-jwt-authentication-oauth.md</a></li>
<li>è¯‘è€…ï¼š<a href="https://github.com/HytonightYX" target="_blank" rel="noopener">HytonightYX</a></li>
<li>æ ¡å¯¹è€…ï¼š<a href="https://github.com/HZNU-Qiu" target="_blank" rel="noopener">HZNU-Qiu</a>,<a href="https://github.com/xionglong58" target="_blank" rel="noopener">xionglong58</a></li>
</ul>
</blockquote>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>è¯¸å¦‚ Google Firebaseï¼ŒAWS Cognito ä»¥åŠ Auth0 è¿™æ ·çš„ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡è¶Šæ¥è¶Šæµè¡Œï¼Œç±»ä¼¼äº passport.js è¿™æ ·çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆä¹Ÿæˆä¸ºäº†ä¸šç•Œæ ‡å‡†ï¼Œä½†æ˜¯ä¸€ä¸ªæ™®éæƒ…å†µæ˜¯ï¼Œå¼€å‘è€…ä»¬å…¶å®å¹¶ä¸æ¸…æ¥šå®Œæ•´çš„è®¤è¯æµç¨‹åˆ°åº•æ¶‰åŠé‚£äº›éƒ¨åˆ†ã€‚</p>
<p>è¿™ä¸€ç³»åˆ—å…³äº node.js è®¤è¯çš„æ–‡ç« ï¼Œæ—¨åœ¨è®©ä½ ææ¸…æ¥šä¸€äº›æ¦‚å¿µï¼Œæ¯”å¦‚ JSON Web Token (JWT)ã€ç¤¾äº¤è´¦å·ç™»å½• (OAuth2)ã€ç”¨æˆ·æ¨¡ä»¿ï¼ˆä¸€ä¸ªç®¡ç†å‘˜æ— éœ€å¯†ç ä¾¿èƒ½ä½œä¸ºç‰¹å®šç”¨æˆ·ç™»å½•ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œæ–‡æœ«ä¹Ÿç»™ä½ å‡†å¤‡å¥½äº†ä¸€ä¸ªå®Œæ•´çš„ node.js è®¤è¯æµç¨‹çš„ä»£ç åº“ï¼Œæ”¾åœ¨GitHubä¸Šäº†ï¼Œä½ å¯ä»¥ä½œä¸ºä½ è‡ªå·±é¡¹ç›®çš„åŸºç¡€æ¥ä½¿ç”¨ã€‚</p>
<a id="more"></a>
<h1 id="å‰ç½®çŸ¥è¯†-âœï¸"><a href="#å‰ç½®çŸ¥è¯†-âœï¸" class="headerlink" title="å‰ç½®çŸ¥è¯† âœï¸"></a>å‰ç½®çŸ¥è¯† âœï¸</h1><p>åœ¨é˜…è¯»ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆäº†è§£ï¼š</p>
<ul>
<li>æ•°æ®åº“ä¸­å¦‚ä½•å­˜å‚¨ç”¨æˆ·çš„ email å’Œå¯†ç ï¼Œæˆ–è€…å®¢æˆ·ç«¯IDå’Œå®¢æˆ·ç«¯å¯†é’¥ï¼Œæˆ–è€…å…¶ä»–çš„å¯†é’¥å¯¹ã€‚</li>
<li>è‡³å°‘ä¸€ç§å¥å£®ä¸”é«˜æ•ˆçš„åŠ å¯†ç®—æ³•ã€‚</li>
</ul>
<p>åœ¨æˆ‘å†™ä¸‹è¿™ç¯‡æ–‡ç« ä¹‹æ—¶ï¼Œæˆ‘è®¤ä¸º Argon2 æ˜¯ç›®å‰æœ€å¥½çš„åŠ å¯†ç®—æ³•ï¼Œè¯·ä¸è¦ç”¨ SHA256ï¼ŒSHA512 æˆ–è€… MD5 è¿™ç±»ç®€å•çš„åŠ å¯†ç®—æ³•äº†ã€‚</p>
<p>æœ‰å…³è¿™ç‚¹ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥å»çœ‹çœ‹è¿™ç¯‡éå¸¸æ£’çš„æ–‡ç«  <a href="https://medium.com/@mpreziuso/password-hashing-pbkdf2-scrypt-bcrypt-and-argon2-e25aaf41598e" target="_blank" rel="noopener">choosing a password hashing algorithmï¼ˆå¦‚ä½•é€‰æ‹©å¯†ç å“ˆå¸Œç®—æ³•ï¼‰</a>ã€‚</p>
<h2 id="å†™ä¸€ä¸ªæ³¨å†Œç¨‹åº-ğŸ¥‡"><a href="#å†™ä¸€ä¸ªæ³¨å†Œç¨‹åº-ğŸ¥‡" class="headerlink" title="å†™ä¸€ä¸ªæ³¨å†Œç¨‹åº ğŸ¥‡"></a>å†™ä¸€ä¸ªæ³¨å†Œç¨‹åº ğŸ¥‡</h2><p>æ–°ç”¨æˆ·åˆ›å»ºè´¦æˆ·æ—¶ï¼Œå¿…é¡»å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†å¹¶å°†å…¶ä¸ç”µå­é‚®ä»¶å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯ï¼ˆæ¯”å¦‚ç”¨æˆ·é…ç½®æ–‡ä»¶ã€æ—¶é—´æˆ³ç­‰ç­‰ï¼‰ä¸€èµ·å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ </p>
<p><strong>æç¤º:ä½ å¯ä»¥å»ä¹‹å‰çš„æ–‡ç« äº†è§£ node.js çš„é¡¹ç›®ç»“æ„ <a href="https://softwareontheroad.com/ideal-nodejs-project-structure" target="_blank" rel="noopener">Bulletproof node.js project architecture ğŸ›¡ï¸</a></strong></p>
<pre><code class="javascript">import * as argon2 from &#39;argon2&#39;;

class AuthService {
  public async SignUp(email, password, name): Promise&lt;any&gt; {
    const passwordHashed = await argon2.hash(password);

    const userRecord = await UserModel.create({
      password: passwordHashed,
      email,
      name,
    });
    return {
      // ç»å¯¹ä¸è¦è¿”å›ç”¨æˆ·çš„å¯†ç !!!!
      user: {
        email: userRecord.email,
        name: userRecord.name,
      },
    }
  }
}
</code></pre>
<p>æ•°æ®åº“ä¸­ï¼Œè¿™åç”¨æˆ·çš„è®°å½•çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·ï¼š</p>
<p> <img src="https://user-gold-cdn.xitu.io/2019/12/27/16f4786e85559909?w=876&amp;h=237&amp;f=jpeg&amp;s=35571" alt="User record - Database MongoDB"> <strong>Robo3T for MongoDB</strong></p>
<h2 id="å†æ¥å†™ä¸€ä¸ªç™»å½•ç¨‹åº-ğŸ¥ˆ"><a href="#å†æ¥å†™ä¸€ä¸ªç™»å½•ç¨‹åº-ğŸ¥ˆ" class="headerlink" title="å†æ¥å†™ä¸€ä¸ªç™»å½•ç¨‹åº ğŸ¥ˆ"></a>å†æ¥å†™ä¸€ä¸ªç™»å½•ç¨‹åº ğŸ¥ˆ</h2><p> <img src="https://user-gold-cdn.xitu.io/2019/12/27/16f47875bce9c545?w=1680&amp;h=800&amp;f=jpeg&amp;s=52198" alt="Sign-In Diagram"> </p>
<p>å½“ä¸€åç”¨æˆ·æƒ³è¦ç™»å½•æ—¶ï¼Œä¼šå‘ç”Ÿä¸‹é¢çš„äº‹æƒ…ï¼š</p>
<p>å®¢æˆ·ç«¯å‘é€æˆå¯¹çš„<strong>å…¬å…±æ ‡è¯†ï¼ˆPublic Identificationï¼‰</strong>å’Œ<strong>ç§é’¥ï¼ˆPrivate keyï¼‰</strong></p>
<ul>
<li><p>æœåŠ¡ç«¯æ ¹æ®å‘æ¥çš„ email å»æ•°æ®åº“æŸ¥æ‰¾ç”¨æˆ·è®°å½•ã€‚</p>
</li>
<li><p>å¦‚æœæ‰¾åˆ°äº†ï¼ŒæœåŠ¡ç«¯ä¼šå°†æ”¶åˆ°çš„å¯†ç è¿›è¡Œå“ˆå¸Œï¼Œç„¶åå’Œæ•°æ®åº“ä¸­å·²ç»å“ˆå¸Œè¿‡çš„å¯†ç è¿›è¡Œæ¯”å¯¹ã€‚</p>
</li>
<li><p>å¦‚æœè¿™ä¸¤ä¸ªå“ˆå¸Œå€¼å¯¹ä¸Šäº†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±å‘ä¸€ä¸ª JSON Web Token (JWT)ã€‚</p>
</li>
</ul>
<p>è¿™ä¸ª JWT å°±æ˜¯ä¸€ä¸ªä¸´æ—¶ keyï¼Œå®¢æˆ·ç«¯æ¯æ¬¡å‘å™¨è¯·æ±‚éƒ½éœ€è¦å¸¦ä¸Šè¿™ä¸ª Token</p>
<pre><code class="javascript">import * as argon2 from &#39;argon2&#39;;

class AuthService {
  public async Login(email, password): Promise&lt;any&gt; {
    const userRecord = await UserModel.findOne({ email });
    if (!userRecord) {
      throw new Error(&#39;User not found&#39;)
    } else {
      const correctPassword = await argon2.verify(userRecord.password, password);
      if (!correctPassword) {
        throw new Error(&#39;Incorrect password&#39;)
      }
    }

    return {
      user: {
        email: userRecord.email,
        name: userRecord.name,
      },
      token: this.generateJWT(userRecord),
    }
  }
}
</code></pre>
<p>è¿™é‡Œå¯†ç è®¤è¯ä½¿ç”¨äº† argon2 åº“æ¥é˜²æ­¢æ—¶åºæ”»å‡»ï¼ˆtiming-based attacksï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ”»å‡»è€…è¯•å›¾é è›®åŠ›ç ´è§£å£ä»¤æ—¶éœ€è¦ä¸¥æ ¼éµå¾ª<a href="https://en.wikipedia.org/wiki/Timing_attack" target="_blank" rel="noopener">æœåŠ¡å™¨å“åº”æ—¶é—´</a>çš„ç›¸å…³å‡†åˆ™ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è®¨è®ºä¸€ä¸‹å¦‚ä½•ç”Ÿæˆ JWTã€‚</p>
<h1 id="ä½†æ˜¯ï¼ŒJWTåˆ°åº•æ˜¯å•¥ï¼Ÿ-ğŸ‘©â€ğŸ«"><a href="#ä½†æ˜¯ï¼ŒJWTåˆ°åº•æ˜¯å•¥ï¼Ÿ-ğŸ‘©â€ğŸ«" class="headerlink" title="ä½†æ˜¯ï¼ŒJWTåˆ°åº•æ˜¯å•¥ï¼Ÿ ğŸ‘©â€ğŸ«"></a>ä½†æ˜¯ï¼ŒJWTåˆ°åº•æ˜¯å•¥ï¼Ÿ ğŸ‘©â€ğŸ«</h1><p>ä¸€ä¸ª JSON Web Token or JWT æ˜¯ä¸€ä¸ªä»¥å­—ç¬¦ä¸²æˆ–è€… Token å½¢å¼å­˜å‚¨çš„ã€ç»è¿‡ç¼–ç çš„ JSON å¯¹è±¡ã€‚</p>
<p>ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ cookie çš„æ›¿ä»£è€…ã€‚</p>
<p>Token æœ‰ä¸‹é¢ä¸‰ä¸ªéƒ¨åˆ†ï¼ˆä¸åŒé¢œè‰²æ ‡æ³¨ï¼‰</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f4788494504f1c?w=572&amp;h=160&amp;f=jpeg&amp;s=19098" alt="JSON Web Token example"> </p>
<p>JWT ä¸­çš„æ•°æ®å¯ä»¥æ— éœ€<strong>å¯†é’¥ï¼ˆSecretï¼‰</strong>æˆ–<strong>ç­¾åï¼ˆSignature)</strong>åœ¨å®¢æˆ·ç«¯è§£ç ã€‚</p>
<p>å› æ­¤å¯¹äºç”¨æˆ·è§’è‰²ä¿¡æ¯ã€é…ç½®æ–‡ä»¶ã€ä»¤ç‰Œè¿‡æœŸæ—¶é—´ç­‰è¿™äº›å‰ç«¯é¢†åŸŸå¸¸è§çš„ä¿¡æ¯æˆ–å…ƒæ•°æ®ï¼ˆmetadataï¼‰æ¥è¯´ï¼Œç¼–ç åœ¨ JWT ä¸­ä¸€èµ·ä¼ è¾“å°±å˜å¾—å¾ˆæ–¹ä¾¿ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f4788fce870bbf?w=584&amp;h=616&amp;f=jpeg&amp;s=25245" alt></p>
<h1 id="node-js-ä¸­å¦‚ä½•åˆ›å»º-JWTï¼Ÿ-ğŸ­"><a href="#node-js-ä¸­å¦‚ä½•åˆ›å»º-JWTï¼Ÿ-ğŸ­" class="headerlink" title="node.js ä¸­å¦‚ä½•åˆ›å»º JWTï¼Ÿ ğŸ­"></a>node.js ä¸­å¦‚ä½•åˆ›å»º JWTï¼Ÿ ğŸ­</h1><p>æˆ‘ä»¬å®ç°ä¸€ä¸ª generateToken æ–¹æ³•æ¥å®Œå–„æˆ‘ä»¬çš„è®¤è¯æœåŠ¡ç¨‹åºå§ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨ <code>jsonwebtoken</code> è¿™ä¸ªåº“ï¼ˆä½ å¯ä»¥åœ¨ npmjs.com æ‰¾åˆ°å®ƒï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½åˆ›å»ºä¸€ä¸ª JWT äº†ã€‚</p>
<pre><code class="javascript">import * as jwt from &#39;jsonwebtoken&#39;
class AuthService {
  private generateToken(user) {

    const data =  {
      _id: user._id,
      name: user.name,
      email: user.email
    };
    const signature = &#39;MySuP3R_z3kr3t&#39;;
    const expiration = &#39;6h&#39;;

    return jwt.sign({ data, }, signature, { expiresIn: expiration });
  }
}
</code></pre>
<p>é‡è¦çš„æ˜¯ï¼Œæ°¸è¿œä¸è¦åœ¨ç¼–ç æ•°æ®ä¸­åŒ…å«ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p>ä¸Šé¢ signature å˜é‡å…¶å®å°±æ˜¯ç”¨æ¥ç”Ÿæˆ JWT çš„å¯†é’¥ï¼ˆsecretï¼‰ï¼Œè€Œä¸”ä½ è¦ç¡®ä¿è¿™ä¸ª signature ä¸ä¼šæ³„æ¼å‡ºå»ã€‚</p>
<p>å¦‚æœæ”»å‡»è€…é€šè¿‡æŸç§æ–¹æ³•è·å–äº† signatureï¼Œä»–å°±èƒ½ç”Ÿæˆä»¤ç‰Œå¹¶ä¸”ä¼ªè£…æˆç”¨æˆ·ä»è€Œçªƒå–ä»–ä»¬çš„ä¼šè¯ï¼ˆsessionï¼‰ã€‚</p>
<h2 id="ä¿æŠ¤ç«¯ç‚¹ä»¥åŠéªŒè¯-JWT-âš”ï¸"><a href="#ä¿æŠ¤ç«¯ç‚¹ä»¥åŠéªŒè¯-JWT-âš”ï¸" class="headerlink" title="ä¿æŠ¤ç«¯ç‚¹ä»¥åŠéªŒè¯ JWT âš”ï¸"></a>ä¿æŠ¤ç«¯ç‚¹ä»¥åŠéªŒè¯ JWT âš”ï¸</h2><p>ç°åœ¨ï¼Œå‰ç«¯éœ€è¦åœ¨æ¯ä¸ªè¯·æ±‚ä¸­å¸¦ä¸Š JWT æ‰èƒ½è®¿é—®åˆ°å®‰å…¨ç›®æ ‡ï¼ˆsecure endpointï¼‰äº†ã€‚</p>
<p>ä¸€ä¸ªæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯åœ¨è¯·æ±‚çš„ header ä¸­é™„å¸¦ JWTï¼Œé€šå¸¸æ˜¯ Authorization æ¶ˆæ¯å¤´ï¼ˆAuthorization headerï¼‰ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f478a107523508?w=1127&amp;h=191&amp;f=jpeg&amp;s=29633" alt></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åç«¯ä¸­åˆ›å»ºä¸€ä¸ª express çš„ä¸­é—´ä»¶ã€‚</p>
<p><strong>ä¸­é—´ä»¶ isAuth</strong></p>
<pre><code class="javascript">import * as jwt from &#39;express-jwt&#39;;

// æˆ‘ä»¬å‡å®š JWT å°†ä¼šåœ¨ Authorization è¯·æ±‚å¤´ä¸Šï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥æ”¾åœ¨ req.body æˆ–è€… query å‚æ•°ä¸­ï¼Œä½ åªè¦æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰ä¸ªåˆé€‚çš„å°±å¥½
const getTokenFromHeader = (req) =&gt; {
  if (req.headers.authorization &amp;&amp; req.headers.authorization.split(&#39; &#39;)[0] === &#39;Bearer&#39;) {
    return req.headers.authorization.split(&#39; &#39;)[1];
  }
}

export default jwt({
  secret: &#39;MySuP3R_z3kr3t&#39;, // å¿…é¡»å’Œä¸Šä¸€èŠ‚çš„ä»£ç çš„ signature ä¸€æ ·

  userProperty: &#39;token&#39;, // this is where the next middleware can find the encoded data generated in services/auth:generateToken -&gt; &#39;req.token&#39;

  getToken: getTokenFromHeader, // ä» request ä¸­è·å–åˆ° auth token çš„æ–¹æ³•
})
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªèƒ½ä»æ•°æ®åº“ä¸­è·å–åˆ°å®Œæ•´ç”¨æˆ·è®°å½•çš„ä¸­é—´ä»¶ï¼Œå¹¶ä¸”å°†è¿™äº›ç”¨æˆ·ä¿¡æ¯æ”¾è¿› request ä¸­ã€‚</p>
<pre><code class="javascript">export default (req, res, next) =&gt; {
 const decodedTokenData = req.tokenData;
 const userRecord = await UserModel.findOne({ _id: decodedTokenData._id })

 req.currentUser = userRecord;

 if(!userRecord) {
   return res.status(401).end(&#39;User not found&#39;)
 } else {
   return next();
 }
}
</code></pre>
<p>ç°åœ¨å°±å¯ä»¥è·³è½¬åˆ°ç”¨æˆ·è¯·æ±‚çš„è·¯ç”±äº†</p>
<pre><code class="javascript">  import isAuth from &#39;../middlewares/isAuth&#39;;
  import attachCurrentUser from &#39;../middlewares/attachCurrentUser&#39;;
  import ItemsModel from &#39;../models/items&#39;;

  export default (app) =&gt; {
    app.get(&#39;/inventory/personal-items&#39;, isAuth, attachCurrentUser, (req, res) =&gt; {
      const user = req.currentUser;

      const userItems = await ItemsModel.find({ owner: user._id });

      return res.json(userItems).status(200);
    })
  }
</code></pre>
<p>ç»è¿‡ä¸¤ä¸ªä¸­é—´ä»¶è®¿é—®åˆ°çš„ inventory/personal-items è·¯ç”±å°±æ˜¯å®‰å…¨çš„ã€‚ä½ éœ€è¦æœ‰æ•ˆçš„ JWT æ‰èƒ½è®¿é—®è¿™ä¸ªè·¯ç”±ï¼Œå½“ç„¶å–½ï¼Œè·¯ç”±ä¹Ÿéœ€è¦ JWT ä¸­çš„ç”¨æˆ·ä¿¡æ¯æ‰èƒ½å»æ•°æ®åº“ä¸­æ­£ç¡®æŸ¥æ‰¾ç›¸åº”çš„ä¿¡æ¯ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆ-JWT-æ˜¯å®‰å…¨çš„"><a href="#ä¸ºä»€ä¹ˆ-JWT-æ˜¯å®‰å…¨çš„" class="headerlink" title="ä¸ºä»€ä¹ˆ JWT æ˜¯å®‰å…¨çš„ ?"></a>ä¸ºä»€ä¹ˆ JWT æ˜¯å®‰å…¨çš„ ?</h2><p>ä½ è¯»åˆ°è¿™é‡Œï¼Œé€šå¸¸ä¼šæƒ³åˆ°è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>Qï¼šå¦‚æœå¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸­è§£ç  JWT æ•°æ®çš„è¯ï¼Œåˆ«äººèƒ½å¦ä¿®æ”¹å…¶ä¸­ç”¨æˆ· id æˆ–è€…å…¶å®ƒçš„æ•°æ®å‘¢ï¼Ÿ</p>
<p>Aï¼šè™½ç„¶ä½ å¯ä»¥è½»æ˜“åœ°è§£ç  JWTï¼Œä½†æ˜¯æ²¡æœ‰ JWT ç”Ÿæˆæ—¶çš„å¯†é’¥ï¼ˆSecretï¼‰å°±æ— æ³•å¯¹ä¿®æ”¹åçš„æ–°æ•°æ®è¿›è¡Œç¼–ç ã€‚</p>
<p>ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œåƒä¸‡ä¸è¦æ³„æ¼å¯†é’¥ï¼ˆsecretï¼‰ã€‚</p>
<p>æˆ‘ä»¬çš„æœåŠ¡ç«¯ä¼šåœ¨ <code>IsAuth</code> è¿™ä¸ªä½¿ç”¨äº† <code>express-jwt</code> åº“çš„ä¸­é—´ä»¶ä¸­æ ¡éªŒå¯†é’¥ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æ˜ç™½äº† JWT æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å»çœ‹ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½ã€‚</p>
<h2 id="å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·-ğŸ•µï¸"><a href="#å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·-ğŸ•µï¸" class="headerlink" title="å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ· ğŸ•µï¸"></a>å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ· ğŸ•µï¸</h2><p>ç”¨æˆ·æ¨¡æ‹Ÿæ˜¯ä¸€ç§å¯ä»¥åœ¨æ— éœ€ç”¨æˆ·å¯†ç çš„æƒ…å†µä¸‹ï¼Œä»¥ä¸€ä¸ªç‰¹å®šç”¨æˆ·çš„èº«ä»½ç™»å½•çš„æŠ€æœ¯ã€‚</p>
<p>å¯¹äºè¶…çº§ç®¡ç†å‘˜ï¼ˆsuper adminsï¼‰æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¸®ä»–è§£å†³æˆ–è°ƒè¯•ä¸€ä¸ªä»…ä¼šè¯å¯è§çš„ç”¨æˆ·çš„é—®é¢˜ã€‚</p>
<p>æ²¡æœ‰å¿…è¦å»çŸ¥é“ç”¨æˆ·çš„å¯†ç ï¼Œåªéœ€è¦ä»¥æ­£ç¡®çš„å¯†é’¥å’Œå¿…è¦çš„ç”¨æˆ·ä¿¡æ¯æ¥åˆ›å»ºä¸€ä¸ª JWT å°±å¯ä»¥äº†ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªè·¯å¾„ï¼Œæ¥ç”Ÿæˆæ¨¡æ‹Ÿç”Ÿæˆç‰¹å®šç”¨æˆ·ç™»å½•çš„ JWTã€‚è¿™ä¸ªè·¯å¾„åªèƒ½è¢«è¶…çº§ç®¡ç†å‘˜è´¦æˆ·ä½¿ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¶…çº§ç®¡ç†å‘˜åˆ›å»ºä¸€ä¸ªæ›´é«˜ç­‰çº§çš„è§’è‰²ï¼Œæ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒç®€å•çš„ä¸€ç§å°±æ˜¯ç›´æ¥å»æ•°æ®åº“ä¸­ç»™ç”¨æˆ·è®°å½•æ·»åŠ ä¸€ä¸ªâ€œroleâ€å­—æ®µã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f478aaae779e66?w=977&amp;h=166&amp;f=jpeg&amp;s=28234" alt> </p>
<p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸­é—´ä»¶æ¥æ£€æŸ¥ç”¨æˆ·è§’è‰²ã€‚</p>
<pre><code class="js">export default (requiredRole) =&gt; {
  return (req, res, next) =&gt; {
    if(req.currentUser.role === requiredRole) {
      return next();
    } else {
      return res.status(401).send(&#39;Action not allowed&#39;);
    }
  }
}
</code></pre>
<p>è¿™ä¸ªä¸­é—´ä»¶éœ€è¦æ”¾åœ¨ <code>isAuth</code> å’Œ <code>attachCurrentUser</code> ä¹‹åã€‚</p>
<p>æœ€åï¼Œè¿™ä¸ªè·¯å¾„å°†ä¼šç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿæ¨¡æ‹Ÿç”¨æˆ·çš„ JWT ã€‚</p>
<pre><code class="javascript">  import isAuth from &#39;../middlewares/isAuth&#39;;
  import attachCurrentUser from &#39;../middlewares/attachCurrentUser&#39;;
  import roleRequired from &#39;../middlwares/roleRequired&#39;;
  import UserModel from &#39;../models/user&#39;;

  export default (app) =&gt; {
    app.post(&#39;/auth/signin-as-user&#39;, isAuth, attachCurrentUser, roleRequired(&#39;super-admin&#39;), (req, res) =&gt; {
      const userEmail = req.body.email;

      const userRecord = await UserModel.findOne({ email: userEmail });

      if(!userRecord) {
        return res.status(404).send(&#39;User not found&#39;);
      }

      return res.json({
        user: {
          email: userRecord.email,
          name: userRecord.name
        },
        jwt: this.generateToken(userRecord)
      })
      .status(200);
    })
  }
</code></pre>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆé»‘é­”æ³•ï¼Œè¶…çº§ç®¡ç†å‘˜åªéœ€è¦çŸ¥é“éœ€è¦è¢«æ¨¡æ‹Ÿçš„ç”¨æˆ·çš„Emailï¼ˆå¹¶ä¸”è¿™é‡Œçš„é€»è¾‘ä¸ç™»å½•ååˆ†ç›¸ä¼¼ï¼Œåªæ˜¯æ— éœ€æ£€æŸ¥å£ä»¤çš„æ­£ç¡®æ€§ï¼‰å°±å¯ä»¥æ¨¡æ‹Ÿè¿™ä¸ªç”¨æˆ·äº†ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºä¸éœ€è¦å¯†ç ï¼Œè¿™ä¸ªè·¯å¾„çš„å®‰å…¨æ€§å°±å¾—é  roleRequired ä¸­é—´ä»¶æ¥ä¿è¯äº†ã€‚</p>
<h1 id="ç»“è®º-ğŸ—ï¸"><a href="#ç»“è®º-ğŸ—ï¸" class="headerlink" title="ç»“è®º ğŸ—ï¸"></a>ç»“è®º ğŸ—ï¸</h1><p>è™½ç„¶ä¾èµ–ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å’Œåº“å¾ˆæ–¹ä¾¿ï¼ŒèŠ‚çº¦äº†å¼€å‘æ—¶é—´ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦äº†è§£è®¤è¯èƒŒåçš„åº•å±‚é€»è¾‘å’ŒåŸç†ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ¢è®¨äº† JWT çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©ä¸€ä¸ªå¥½çš„åŠ å¯†ç®—æ³•éå¸¸é‡è¦ï¼Œä»¥åŠå¦‚ä½•å»æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ passport.js è¿™æ ·çš„åº“ï¼Œå°±å¾ˆéš¾åšåˆ°è¿™äº›äº‹ã€‚</p>
<p>åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨é€šè¿‡ä½¿ç”¨ OAuth2 åè®®å’Œæ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚ Firebase ç­‰ç¬¬ä¸‰æ–¹ç”¨äºèº«ä»½éªŒè¯çš„åº“ï¼‰æ¥ä¸ºå®¢æˆ·æä¾›â€œç¤¾äº¤ç™»å½•â€èº«ä»½éªŒè¯çš„ä¸åŒæ–¹æ³•ã€‚</p>
<h3 id="è¿™é‡Œæ˜¯ç¤ºä¾‹ä»“åº“-ğŸ”¬"><a href="#è¿™é‡Œæ˜¯ç¤ºä¾‹ä»“åº“-ğŸ”¬" class="headerlink" title="è¿™é‡Œæ˜¯ç¤ºä¾‹ä»“åº“ ğŸ”¬"></a><a href="https://github.com/santiq/nodejs-auth" target="_blank" rel="noopener">è¿™é‡Œæ˜¯ç¤ºä¾‹ä»“åº“ ğŸ”¬</a></h3><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://security.stackexchange.com/questions/193351/in-2018-what-is-the-recommended-hash-to-store-passwords-bcrypt-scrypt-argon2" target="_blank" rel="noopener">What is the recommended hash to store passwords: bcrypt, scrypt, Argon2?</a></li>
<li><a href="https://en.wikipedia.org/wiki/Timing_attack" target="_blank" rel="noopener">Timing attack</a></li>
</ul>
<blockquote>
<p>å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° <a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a> å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ <strong>æœ¬æ–‡æ°¸ä¹…é“¾æ¥</strong> å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p><a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a> æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º <a href="https://juejin.im" target="_blank" rel="noopener">æ˜é‡‘</a> ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– <a href="https://github.com/xitu/gold-miner#android" target="_blank" rel="noopener">Android</a>ã€<a href="https://github.com/xitu/gold-miner#ios" target="_blank" rel="noopener">iOS</a>ã€<a href="https://github.com/xitu/gold-miner#å‰ç«¯" target="_blank" rel="noopener">å‰ç«¯</a>ã€<a href="https://github.com/xitu/gold-miner#åç«¯" target="_blank" rel="noopener">åç«¯</a>ã€<a href="https://github.com/xitu/gold-miner#åŒºå—é“¾" target="_blank" rel="noopener">åŒºå—é“¾</a>ã€<a href="https://github.com/xitu/gold-miner#äº§å“" target="_blank" rel="noopener">äº§å“</a>ã€<a href="https://github.com/xitu/gold-miner#è®¾è®¡" target="_blank" rel="noopener">è®¾è®¡</a>ã€<a href="https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½" target="_blank" rel="noopener">äººå·¥æ™ºèƒ½</a>ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ <a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a>ã€<a href="http://weibo.com/juejinfanyi" target="_blank" rel="noopener">å®˜æ–¹å¾®åš</a>ã€<a href="https://zhuanlan.zhihu.com/juejinfanyi" target="_blank" rel="noopener">çŸ¥ä¹ä¸“æ </a>ã€‚</p>
</blockquote>

        </div>
        
            <ul class="post-copyright">
            <li><strong>æœ¬æ–‡æ ‡é¢˜ï¼š</strong><a href="http://yunxi.site/blog/2019/12/27/ç¿»è¯‘-ä½ ä¸éœ€è¦-passport-js-â€”-node-jsè®¤è¯æŒ‡å—/">[ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å—</a></li>
            <li><strong>æœ¬æ–‡ä½œè€…ï¼š</strong><a href="http://yunxi.site/blog">Hytonightäº‘æ¯</a></li>
            <li><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://yunxi.site/blog/2019/12/27/ç¿»è¯‘-ä½ ä¸éœ€è¦-passport-js-â€”-node-jsè®¤è¯æŒ‡å—/">http://yunxi.site/blog/2019/12/27/ç¿»è¯‘-ä½ ä¸éœ€è¦-passport-js-â€”-node-jsè®¤è¯æŒ‡å—/</a></li>
            <li><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>2019-12-27</li>
            <li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
            </li>
            </ul>
        
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/blog/2019/10/22/æ ¡å¯¹-å¦‚ä½•è®¾è®¡ä¸€æ¬¾è®¨äººå–œæ¬¢çš„æš—è‰²ä¸»é¢˜/">
                <span class="level-item">æ ¡å¯¹-å¦‚ä½•è®¾è®¡ä¸€æ¬¾è®¨äººå–œæ¬¢çš„æš—è‰²ä¸»é¢˜</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comentarios</h3>
        
<script>
    var disqus_config = function () {
        this.page.url = 'http://yunxi.site/blog/2019/12/27/ç¿»è¯‘-ä½ ä¸éœ€è¦-passport-js-â€”-node-jsè®¤è¯æŒ‡å—/';
        this.page.identifier = '2019/12/27/ç¿»è¯‘-ä½ ä¸éœ€è¦-passport-js-â€”-node-jsè®¤è¯æŒ‡å—/';
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'yunxi-blog' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </div>
</div>

</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level" style="margin-bottom:1rem">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-96x96 has-mb-6" src="/blog/assets/img/avater.png" alt="Hytonightäº‘æ¯">
                    
                    
                    <p class="is-size-4 is-block">
                        Hytonightäº‘æ¯
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Junior
                    </p>
                    
                    
                </div>
            </div>
        </nav>
        <nav class="level menu-list is-mobile" style="margin-bottom:1rem">
            <div class="level-item has-text-centered is-marginless">
                <a href="/blog/archives/">
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        16
                    </p>
                </a>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <a href="/blog/categories/">
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        0
                    </p>
                </a>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <a href="/blog/tags/">
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        16
                    </p>
                </a>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://www.github.com/HytonightYX" target="_blank">
                <i class="fab fa-github"></i>&nbsp;&nbsp;SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="QQ" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1044865610">
                
                <i class="fab fa-qq"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="ZhiHu" href="https://www.zhihu.com/people/HytonightYX">
                
                <i class="fab fa-zhihu"></i>
                
            </a>
            
        </div>
        
    </div>
</div>

    
        
<div class="card widget column-left is-sticky" id="toc">
    <div class="card-content">
        <div class="menu" style="max-height: 800px; overflow: auto;">
            <h3 class="menu-label">
                CatÃ¡logo
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#ç®€ä»‹">
        <span class="has-mr-6">1</span>
        <span>ç®€ä»‹</span>
        </a></li><li>
        <a class="is-flex" href="#å‰ç½®çŸ¥è¯†-âœï¸">
        <span class="has-mr-6">2</span>
        <span>å‰ç½®çŸ¥è¯† âœï¸</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#å†™ä¸€ä¸ªæ³¨å†Œç¨‹åº-ğŸ¥‡">
        <span class="has-mr-6">2.1</span>
        <span>å†™ä¸€ä¸ªæ³¨å†Œç¨‹åº ğŸ¥‡</span>
        </a></li><li>
        <a class="is-flex" href="#å†æ¥å†™ä¸€ä¸ªç™»å½•ç¨‹åº-ğŸ¥ˆ">
        <span class="has-mr-6">2.2</span>
        <span>å†æ¥å†™ä¸€ä¸ªç™»å½•ç¨‹åº ğŸ¥ˆ</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#ä½†æ˜¯ï¼ŒJWTåˆ°åº•æ˜¯å•¥ï¼Ÿ-ğŸ‘©â€ğŸ«">
        <span class="has-mr-6">3</span>
        <span>ä½†æ˜¯ï¼ŒJWTåˆ°åº•æ˜¯å•¥ï¼Ÿ ğŸ‘©â€ğŸ«</span>
        </a></li><li>
        <a class="is-flex" href="#node-js-ä¸­å¦‚ä½•åˆ›å»º-JWTï¼Ÿ-ğŸ­">
        <span class="has-mr-6">4</span>
        <span>node.js ä¸­å¦‚ä½•åˆ›å»º JWTï¼Ÿ ğŸ­</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#ä¿æŠ¤ç«¯ç‚¹ä»¥åŠéªŒè¯-JWT-âš”ï¸">
        <span class="has-mr-6">4.1</span>
        <span>ä¿æŠ¤ç«¯ç‚¹ä»¥åŠéªŒè¯ JWT âš”ï¸</span>
        </a></li><li>
        <a class="is-flex" href="#ä¸ºä»€ä¹ˆ-JWT-æ˜¯å®‰å…¨çš„">
        <span class="has-mr-6">4.2</span>
        <span>ä¸ºä»€ä¹ˆ JWT æ˜¯å®‰å…¨çš„ ?</span>
        </a></li><li>
        <a class="is-flex" href="#å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·-ğŸ•µï¸">
        <span class="has-mr-6">4.3</span>
        <span>å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ· ğŸ•µï¸</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#ç»“è®º-ğŸ—ï¸">
        <span class="has-mr-6">5</span>
        <span>ç»“è®º ğŸ—ï¸</span>
        </a><ul class="menu-list"><ul class="menu-list"><li>
        <a class="is-flex" href="#è¿™é‡Œæ˜¯ç¤ºä¾‹ä»“åº“-ğŸ”¬">
        <span class="has-mr-6">5.1.1</span>
        <span>è¿™é‡Œæ˜¯ç¤ºä¾‹ä»“åº“ ğŸ”¬</span>
        </a></li><li>
        <a class="is-flex" href="#å‚è€ƒèµ„æ–™">
        <span class="has-mr-6">5.1.2</span>
        <span>å‚è€ƒèµ„æ–™</span>
        </a></li></ul></ul></li></ul>
        </div>
    </div>
</div>


    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/blog/">
                
                    <img src="/blog/assets/img/logo.png" alt="[ç¿»è¯‘]ä½ ä¸éœ€è¦ passport.js â€” node.jsè®¤è¯æŒ‡å—" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Hytonightäº‘æ¯&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                        
                        <i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-nc"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i>&nbsp;
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="AlphaLxy GitHub" href="https://www.github.com/AlphaLxy">
                        
                        <i class="fab fa-github"></i>&nbsp;
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/blog/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/blog/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/blog/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/blog/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/blog/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Entradas',
                PAGES: 'Pages',
                CATEGORIES: 'Categorias',
                TAGS: 'Etiquetas',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/blog/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/blog/js/insight.js" defer></script>
<link rel="stylesheet" href="/blog/css/search.css">
<link rel="stylesheet" href="/blog/css/insight.css">
    
</body>
</html>